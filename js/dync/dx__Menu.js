"use strict";ComApp.app.maCurrentView.__$cartPopup=function(n,e,t){var i,a,o,r=$("<div class='shared_popup placeorder'></div>").appendTo(".dx-viewport"),c={},l=n._cartData(),d=function(r){var d=e.find(".dathangcase"),s=e.find(".deliverytime"),p=s.children().first();c[3]=$(d[3]).clone(),$(d[3]).remove(),c[2]=$(d[2]).clone(),$(d[2]).remove(),c[0]=$(d[0]).clone(),$(d[0]).remove();var v={},m=n._deliInfo(),h=e.find(".scrollbody"),g=function(e,t){n._cbCart(e.parent().data().id.toString(),{sl:t})},b=function(n,t){if(n&&n.length>0){var a=l[n.data().id.toString()];null!=t&&null!=t?a.sl=parseInt(t):n.find(".col-qty input").val(a.sl),parseFloat(a.giaban),parseFloat(a.sl),n.find(".col-total p").html(_Tien(a.sl*a.giaban,0))}var o=e.find(".tf .row .subtotal");o[0].innerHTML=_Tien(0,0),o[1].innerHTML=_Tien(0,0),i=0,$.each(l,function(n,e){i+=e.sl*e.giaban}),o[2].innerHTML=_Tien(0,0),o[3].innerHTML=_Tien(i,0)},T=function(n){var e=l[n.data().id];n.find(".col-pro >*").each(function(n,t){switch(t.tagName.toLowerCase()){case"span":t.innerHTML="G: "+_Tien(e.giaban,0);break;case"img":var i=e.imgs.split(",");i.length>0&&""!=i[0]&&(t.src=i[0]);break;case"p":t.innerHTML=e.ten}}),n.find(".col-price").html("<p>"+_Tien(e.giaban,0)+"</p>"),n.find(".col-vat p").html(_Tien(e.v,0)),n.find(".col-qty input").change(function(){var n=$(this),e=$.trim(n.val());""!=e&&"0"!=e&&function(n){if(isNaN(n))return!1;var e=parseFloat(n);return(0|e)===e&&e>0}(e)?(e=parseInt(e),n.val(e)):(e=1,n.val(1)),g(n.parent(),e),b(n.parent().parent(),e)}).on("keyup",function(n){n.keyCode||n.which;var e=$(this),t=e.val().length,i=e.attr("maxlength");t>i&&e.val(e.val().substring(0,i))}),b(n,null)},_=1,w=h.children().first();w.detach(),r.append(u),ComApp.app._localizeMarkup(e),u.append(e),"1"==mobileClient&&(v={onScroll:function(n){clearTimeout(a),a=setTimeout(function(){o=n.scrollOffset},500)}}),u.dxScrollView(v).dxScrollView("instance"),p.detach(),s.html(u.find(".dx-scrollview-scrollbottom-indicator").clone()),$.each(l,function(e,t){var i=w.clone();_%2==0&&i.addClass("row row-bg2"),i.data("id",e),i.find(".removeitem").click(function(e){if("1"!=clickPrevent){clickLocked();var t=$(this);t.attr("tabindex",1).focus(),setTimeout(function(){!function(e){DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(t){if(t){var i=2,a=function(){0==--i&&($.isEmptyObject(l)?f.hide():(b(null,null),h.find(".layout-inline.row").each(function(n){n>0&&n%2==1?$(this).addClass("row-bg2"):$(this).removeClass("row-bg2")})))};setTimeout(function(){n._rmvOutCart(e.parent().data().id,a)}),setTimeout(function(){e.parent().fadeOut("slow",function(n){$(this).remove(),a()})},10)}})}(t)},300),setTimeout(function(){t.removeAttr("tabindex").blur()},1e3)}}),T(i),h.append(i),_++}),e.on("click",".a_qty",function(n){if("1"!=clickPrevent){clickLocked(100);var e=$(n.target);e.attr("tabindex",1).focus(),setTimeout(function(){!function(n){var e=n.parent(),t=e.find("input"),i=parseInt(t.val()),a=n.hasClass("qty-plus");if(i>1||1==a){var o=i+parseInt(a?1:-1);g(e,o),b(e.parent(),null),setTimeout(function(){e.find("input").select()},300)}}(e)},100),setTimeout(function(){e.removeAttr("tabindex").blur()},1e3)}}),t.then(function(e,t){var i;if(s.empty(),"1"==e&&t.length>0){i=t[0];for(var a=0;a<t.length;a+=2){var o=p.clone();o.attr("id","deliver_"+t[a]),o.find("input").val(t[a]),o.append(t[a+1]),s.append(o),m.hasOwnProperty("time")&&m.time==t[a]&&(i=t[a])}s.find("input").change(function(){n._cbCart("delivery",{time:this.value})}),s.find('input[value="'+i+'"]').prop("checked",!0).trigger("change"),$(d[1]).fadeIn("slow").find("#fastcartform input").change(function(){var e=$(this),t={};t[e.attr("name")]=e.val(),n._cbCart("delivery",t)}).each(function(n,e){var t=$(e);m.hasOwnProperty(t.attr("name"))&&t.val(m[t.attr("name")])})}else s.html('<label class="stopreceiving">'+t.toString()+"</label>")})},u=$("<div/>"),s=function(n){clearTimeout(a),u.data().dxScrollView.scrollTo(o)},f=r.dxPopup({fullScreen:!0,dragEnabled:!1,showTitle:!0,deferRendering:!1,contentTemplate:function(n){d(n)},onHidden:function(){scrReleased(),_virtualKeyboard("off",null,s),r.remove(),n.showCart=!1},onHiding:function(){scrLocked()},onShown:function(t){n.showCart=!0,setTimeout(function(){var t;n.cartcolQty(),_virtualKeyboard("on",null,s),t=function(e){scrLocked(),setTimeout(function(){var t=u.find(".removeitem"),i=t.length,a=function(){0==--i&&(e?e():(f.hide(),scrReleased()))};t.each(function(e,t){var i=t;setTimeout(function(){n._rmvOutCart($(i).parent().data().id,a)}),setTimeout(function(){$(i).parent().fadeOut("slow",function(n){$(this).remove(),a()})})})},10)},u.find("#cart_clear").click(function(n,e){"1"!=clickPrevent&&(clickLocked(),DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(n){n&&t()}))}),_$dondatHang(0,e,u,c,{_deliInfo:function(){return n._deliInfo()},cartData:function(){return l},tongcong:function(){return i}},function(e){if("clearAll"==e.act){var i={};i.uid=e.data.uid,n._cbCart("delivery",i),t(function(){f.hide(),setTimeout(function(){memorybag.navigate_Order={id:1},ComApp.app.navigate("Order",{root:!0})},100)})}else"hidePU"==e.act&&f.hide()})},500),t.element.find(".dx-toolbar-center").html(gbM("S1_002")),scrReleased()}}).dxPopup("instance");setTimeout(function(){f.show()},100)};
"use strict";ComApp.app.maCurrentView__$cartPopup=function(n,e,t){var i,a,r,o=$("<div class='shared_popup placeorder'></div>").appendTo(".dx-viewport"),c={},l=n._cartData(),d=function(o){var d=e.find(".dathangcase"),f=e.find(".deliverytime"),p=f.children().first();c[3]=$(d[3]).clone(),$(d[3]).remove(),c[2]=$(d[2]).clone(),$(d[2]).remove(),c[0]=$(d[0]).clone(),$(d[0]).remove();var v={},m=n._deliInfo(),h=e.find(".scrollbody"),g=function(e,t){n._cbCart(e.parent().data().id.toString(),{sl:t})},b=function(n,t){if(n&&n.length>0){var a=l[n.data().id.toString()];null!=t&&null!=t?a.sl=parseInt(t):n.find(".col-qty input").val(a.sl),parseFloat(a.giaban),parseFloat(a.sl),n.find(".col-total p").html(_Tien(a.sl*a.giaban,0))}var r=e.find(".tf .row .subtotal");r[0].innerHTML=_Tien(0,0),r[1].innerHTML=_Tien(0,0),i=0,$.each(l,function(n,e){i+=e.sl*e.giaban});var o=0;if(m.hasOwnProperty("gamegiamgia")){var c=m.gamegiamgia.split("|");o=fnceiling(i*parseInt(c[0])/100,1e3),c[2]=o,m.gamegiamgia=c.join("|"),i-=o}r[2].innerHTML=_Tien(o,0),r[3].innerHTML=_Tien(i,0)},T=function(n){var e=l[n.data().id];n.find(".col-pro >*").each(function(n,t){switch(t.tagName.toLowerCase()){case"span":t.innerHTML="G: "+_Tien(e.giaban,0);break;case"img":var i=e.imgs.split(",");i.length>0&&""!=i[0]&&(t.src=i[0]);break;case"p":t.innerHTML=e.ten}}),n.find(".col-price").html("<p>"+_Tien(e.giaban,0)+"</p>"),n.find(".col-vat p").html(_Tien(e.v,0)),n.find(".col-qty input").change(function(){var n=$(this),e=$.trim(n.val());""!=e&&"0"!=e&&function(n){if(isNaN(n))return!1;var e=parseFloat(n);return(0|e)===e&&e>0}(e)?(e=parseInt(e),n.val(e)):(e=1,n.val(1)),g(n.parent(),e),b(n.parent().parent(),e)}).on("keyup",function(n){n.keyCode||n.which;var e=$(this),t=e.val().length,i=e.attr("maxlength");t>i&&e.val(e.val().substring(0,i))}),b(n,null)},_=1,w=h.children().first();w.detach(),o.append(u),ComApp.app._localizeMarkup(e),u.append(e),"1"==mobileClient&&(v={onScroll:function(n){clearTimeout(a),a=setTimeout(function(){r=n.scrollOffset},500)}}),u.dxScrollView(v).dxScrollView("instance"),p.detach(),f.html(u.find(".dx-scrollview-scrollbottom-indicator").clone()),$.each(l,function(e,t){var i=w.clone();_%2==0&&i.addClass("row row-bg2"),i.data("id",e),i.find(".removeitem").click(function(e,t){if(null==t){if("1"==clickPrevent)return;clickLocked()}var i=$(this);i.attr("tabindex",1).focus(),setTimeout(function(){!function(e,t){var i=function(){var t=2,i=function(){0==--t&&($.isEmptyObject(l)?s.hide():(b(null,null),h.find(".layout-inline.row").each(function(n){n>0&&n%2==1?$(this).addClass("row-bg2"):$(this).removeClass("row-bg2")})))};setTimeout(function(){n._rmvOutCart(e.parent().data().id,i)}),setTimeout(function(){e.parent().fadeOut("slow",function(n){$(this).remove(),i()})},10)};null==t?DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(n){n&&i()}):i()}(i,t)},300),setTimeout(function(){i.removeAttr("tabindex").blur()},1e3)}),T(i),h.append(i),_++}),e.on("click",".a_qty",function(n){if("1"!=clickPrevent){clickLocked(100);var e=$(n.target);e.attr("tabindex",1).focus(),setTimeout(function(){!function(n){var e=n.parent(),t=e.find("input"),i=parseInt(t.val()),a=n.hasClass("qty-plus");if(i>1||1==a){var r=i+parseInt(a?1:-1);g(e,r),b(e.parent(),null),setTimeout(function(){e.find("input").select()},300)}}(e)},100),setTimeout(function(){e.removeAttr("tabindex").blur()},1e3)}}),t.then(function(e,t){var i,a=localDB.exe("get","exUI",null,0)||[];if(f.empty(),"1"==e&&t.length>0){i=t[0];for(var r=0;r<t.length;r+=2){var o=p.clone();o.attr("id","deliver_"+t[r]),o.find("input").val(t[r]),o.append(t[r+1]),f.append(o),m.hasOwnProperty("time")&&m.time==t[r]&&(i=t[r])}f.find("input").change(function(){n._cbCart("delivery",{time:this.value})}),f.find('input[value="'+i+'"]').prop("checked",!0).trigger("change"),$(d[1]).fadeIn("slow").find("#fastcartform input").change(function(){var e=$(this),t={};t[e.attr("name")]=e.val(),n._cbCart("delivery",t)}).each(function(n,e){var t=$(e),i=t.attr("name");m.hasOwnProperty(i)&&t.val(m[i]),lookupmore(t,a,i)})}else f.html('<label class="stopreceiving">'+t.toString()+"</label>")}),quanlydangnhap(m,e)},u=$("<div/>"),f=function(n){clearTimeout(a),u.data().dxScrollView.scrollTo(r)},s=o.dxPopup({fullScreen:!0,dragEnabled:!1,showTitle:!0,deferRendering:!1,contentTemplate:function(n){d(n)},onHidden:function(){scrReleased(),_virtualKeyboard("off",null,f),o.remove(),n.showCart=!1},onHiding:function(){scrLocked()},onShown:function(t){n.showCart=!0,setTimeout(function(){var t;n.cartcolQty(),_virtualKeyboard("on",null,f),t=function(e){scrLocked(),setTimeout(function(){var t=u.find(".removeitem"),i=t.length,a=function(){0==--i&&(e?e():(s.hide(),scrReleased()))};t.each(function(e,t){var i=t;setTimeout(function(){n._rmvOutCart($(i).parent().data().id,a)}),setTimeout(function(){$(i).parent().fadeOut("slow",function(n){$(this).remove(),a()})})})},10)},u.find("#cart_clear").click(function(n,e){"1"!=clickPrevent&&(clickLocked(),DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(n){n&&t()}))}),_$dondatHang(0,e,u,c,{_deliInfo:function(){return n._deliInfo()},cartData:function(){return l},tongcong:function(){return i}},function(e){if("clearAll"==e.act){var i={},a=function(){setTimeout(function(){memorybag.navigate_Order={id:1,params:e.data},ComApp.app.navigate("Order",{root:!0})},100)};i.uid=e.data.uid,n._cbCart("delivery",i),t(function(){e.data.hasOwnProperty("luckyspin")?do_km(e.data,function(){a()}):a(),s.hide()})}else"hidePU"==e.act?s.hide():"rmvitem"==e.act&&o.find(".cartx .scrollbody .layout-inline.row").each(function(n,t){var i=$(t);if(i.data().id==e.id)return i.find(".removeitem").trigger("click",{id:e.id}),!1})})},500),t.element.find(".dx-toolbar-center").html(gbM("S1_002")),scrReleased()}}).dxPopup("instance");setTimeout(function(){s.show()},100)};
"use strict";ComApp.app.maCurrentView__$cartPopup=function(n,t,e){var i,a,o,r=$("<div class='shared_popup placeorder'></div>").appendTo(".dx-viewport"),c={},l=n._cartData(),d=function(r){var d=t.find(".dathangcase"),f=t.find(".deliverytime"),p=f.children().first();c[3]=$(d[3]).clone(),$(d[3]).remove(),c[2]=$(d[2]).clone(),$(d[2]).remove(),c[0]=$(d[0]).clone(),$(d[0]).remove();var v={},m=n._deliInfo(),h=t.find(".scrollbody"),g=function(t,e){n._cbCart(t.parent().data().id.toString(),{sl:e})},b=function(n,e){if(n&&n.length>0){var a=l[n.data().id.toString()];null!=e&&null!=e?a.sl=parseInt(e):n.find(".col-qty input").val(a.sl),parseFloat(a.giaban),parseFloat(a.sl),n.find(".col-total p").html(_Tien(a.sl*a.giaban,0))}var o=t.find(".tf .row .subtotal");o[0].innerHTML=_Tien(0,0),o[1].innerHTML=_Tien(0,0),i=0,$.each(l,function(n,t){i+=t.sl*t.giaban}),o[2].innerHTML=_Tien(0,0),o[3].innerHTML=_Tien(i,0)},T=function(n){var t=l[n.data().id];n.find(".col-pro >*").each(function(n,e){switch(e.tagName.toLowerCase()){case"span":e.innerHTML="G: "+_Tien(t.giaban,0);break;case"img":var i=t.imgs.split(",");i.length>0&&""!=i[0]&&(e.src=i[0]);break;case"p":e.innerHTML=t.ten}}),n.find(".col-price").html("<p>"+_Tien(t.giaban,0)+"</p>"),n.find(".col-vat p").html(_Tien(t.v,0)),n.find(".col-qty input").change(function(){var n=$(this),t=$.trim(n.val());""!=t&&"0"!=t&&function(n){if(isNaN(n))return!1;var t=parseFloat(n);return(0|t)===t&&t>0}(t)?(t=parseInt(t),n.val(t)):(t=1,n.val(1)),g(n.parent(),t),b(n.parent().parent(),t)}).on("keyup",function(n){n.keyCode||n.which;var t=$(this),e=t.val().length,i=t.attr("maxlength");e>i&&t.val(t.val().substring(0,i))}),b(n,null)},_=1,w=h.children().first();w.detach(),r.append(u),ComApp.app._localizeMarkup(t),u.append(t),"1"==mobileClient&&(v={onScroll:function(n){clearTimeout(a),a=setTimeout(function(){o=n.scrollOffset},500)}}),u.dxScrollView(v).dxScrollView("instance"),p.detach(),f.html(u.find(".dx-scrollview-scrollbottom-indicator").clone()),$.each(l,function(t,e){var i=w.clone();_%2==0&&i.addClass("row row-bg2"),i.data("id",t),i.find(".removeitem").click(function(t,e){if(null==e){if("1"==clickPrevent)return;clickLocked()}var i=$(this);i.attr("tabindex",1).focus(),setTimeout(function(){!function(t,e){var i=function(){var e=2,i=function(){0==--e&&($.isEmptyObject(l)?s.hide():(b(null,null),h.find(".layout-inline.row").each(function(n){n>0&&n%2==1?$(this).addClass("row-bg2"):$(this).removeClass("row-bg2")})))};setTimeout(function(){n._rmvOutCart(t.parent().data().id,i)}),setTimeout(function(){t.parent().fadeOut("slow",function(n){$(this).remove(),i()})},10)};null==e?DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(n){n&&i()}):i()}(i,e)},300),setTimeout(function(){i.removeAttr("tabindex").blur()},1e3)}),T(i),h.append(i),_++}),t.on("click",".a_qty",function(n){if("1"!=clickPrevent){clickLocked(100);var t=$(n.target);t.attr("tabindex",1).focus(),setTimeout(function(){!function(n){var t=n.parent(),e=t.find("input"),i=parseInt(e.val()),a=n.hasClass("qty-plus");if(i>1||1==a){var o=i+parseInt(a?1:-1);g(t,o),b(t.parent(),null),setTimeout(function(){t.find("input").select()},300)}}(t)},100),setTimeout(function(){t.removeAttr("tabindex").blur()},1e3)}}),e.then(function(t,e){var i,a=localDB.exe("get","exUI",null,0)||[];if(f.empty(),"1"==t&&e.length>0){i=e[0];for(var o=0;o<e.length;o+=2){var r=p.clone();r.attr("id","deliver_"+e[o]),r.find("input").val(e[o]),r.append(e[o+1]),f.append(r),m.hasOwnProperty("time")&&m.time==e[o]&&(i=e[o])}f.find("input").change(function(){n._cbCart("delivery",{time:this.value})}),f.find('input[value="'+i+'"]').prop("checked",!0).trigger("change"),$(d[1]).fadeIn("slow").find("#fastcartform input").change(function(){var t=$(this),e={};e[t.attr("name")]=t.val(),n._cbCart("delivery",e)}).each(function(n,t){var e=$(t),i=e.attr("name");m.hasOwnProperty(i)&&e.val(m[i]),lookupmore(e,a,i)})}else f.html('<label class="stopreceiving">'+e.toString()+"</label>")}),quanlydangnhap(m,t)},u=$("<div/>"),f=function(n){clearTimeout(a),u.data().dxScrollView.scrollTo(o)},s=r.dxPopup({fullScreen:!0,dragEnabled:!1,showTitle:!0,deferRendering:!1,contentTemplate:function(n){d(n)},onHidden:function(){scrReleased(),_virtualKeyboard("off",null,f),r.remove(),n.showCart=!1},onHiding:function(){scrLocked()},onShown:function(e){n.showCart=!0,setTimeout(function(){var e;n.cartcolQty(),_virtualKeyboard("on",null,f),e=function(t){scrLocked(),setTimeout(function(){var e=u.find(".removeitem"),i=e.length,a=function(){0==--i&&(t?t():(s.hide(),scrReleased()))};e.each(function(t,e){var i=e;setTimeout(function(){n._rmvOutCart($(i).parent().data().id,a)}),setTimeout(function(){$(i).parent().fadeOut("slow",function(n){$(this).remove(),a()})})})},10)},u.find("#cart_clear").click(function(n,t){"1"!=clickPrevent&&(clickLocked(),DevExpress.ui.dialog.confirm('<div style="text-align:center;max-width:300px">'+gbM("S1_027")+"</div>","Confirm changes").done(function(n){n&&e()}))}),_$dondatHang(0,t,u,c,{_deliInfo:function(){return n._deliInfo()},cartData:function(){return l},tongcong:function(){return i}},function(t){if("clearAll"==t.act){var i={},a=function(){setTimeout(function(){memorybag.navigate_Order={id:1,params:t.data},ComApp.app.navigate("Order",{root:!0})},100)};i.uid=t.data.uid,n._cbCart("delivery",i),e(function(){t.data.hasOwnProperty("luckyspin")?do_km(t.data,function(){a()}):a(),s.hide()})}else"hidePU"==t.act?s.hide():"rmvitem"==t.act&&r.find(".cartx .scrollbody .layout-inline.row").each(function(n,e){var i=$(e);if(i.data().id==t.id)return i.find(".removeitem").trigger("click",{id:t.id}),!1})})},500),e.element.find(".dx-toolbar-center").html(gbM("S1_002")),scrReleased()}}).dxPopup("instance");setTimeout(function(){s.show()},100)};